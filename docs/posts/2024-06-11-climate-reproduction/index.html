<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Sunnee Billingsley">
<meta name="dcterms.date" content="2024-06-11">
<meta name="description" content="Understanding the challenges when using longitudinal data with DHS surveys">

<title>Incorporating Climate and Reproductive History Data – IPUMS DHS Climate Change and Health Research Hub</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../images/favicon/favicon-32x32.ico" rel="icon">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/quarto-contrib/fontawesome6-0.1.0/all.css" rel="stylesheet">
<link href="../../site_libs/quarto-contrib/fontawesome6-0.1.0/latex-fontsize.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-0WLH5S9VD5"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-0WLH5S9VD5', { 'anonymize_ip': true});
</script>


<meta property="og:title" content="IPUMS DHS Research Hub — Incorporating Climate and Reproductive History Data">
<meta property="og:description" content="Understanding the challenges when using longitudinal data with DHS surveys">
<meta property="og:image" content="https://ipums.github.io/dhs-research-hub/posts/2024-06-11-climate-reproduction/images/ptest.jpg">
<meta property="og:site_name" content="IPUMS DHS Climate Change and Health Research Hub">
<meta name="twitter:title" content="IPUMS DHS Research Hub — Incorporating Climate and Reproductive History Data">
<meta name="twitter:description" content="Understanding the challenges when using longitudinal data with DHS surveys">
<meta name="twitter:image" content="https://ipums.github.io/dhs-research-hub/posts/2024-06-11-climate-reproduction/images/ptest.jpg">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="floating nav-fixed slimcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="https://www.idhsdata.org/idhs/" class="navbar-brand navbar-brand-logo">
    <img src="../../images/dhs_logo_white.png" alt="" class="navbar-logo">
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Climate Change and Health Research Hub</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Posts</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-getting-started" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Getting Started</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-getting-started">    
        <li>
    <a class="dropdown-item" href="../../posts/2024-02-01-getting-started-with-r/index.html">
 <span class="dropdown-text">An Introduction to R</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../posts/2024-02-02-download-dhs-data/index.html">
 <span class="dropdown-text">Obtaining IPUMS DHS Data</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-community" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Community</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-community">    
        <li>
    <a class="dropdown-item" href="https://forum.ipums.org">
 <span class="dropdown-text">IPUMS Forum</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../CODE_OF_CONDUCT.html">
 <span class="dropdown-text">Code of Conduct</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../LICENSE.html">
 <span class="dropdown-text">License</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://github.com/ipums/dhs-research-hub"> 
<span class="menu-text"><i class="fa-brands fa-github" aria-label="github"></i></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../index.xml"> 
<span class="menu-text"><i class="fa-solid fa-rss" aria-label="rss"></i></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://twitter.com/ipumsGH"> 
<span class="menu-text"><i class="fa-brands fa-x-twitter" aria-label="x-twitter"></i></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://forum.ipums.org"> 
<span class="menu-text"><i class="fa-solid fa-users" aria-label="users"></i></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://www.ipums.org/"> 
<span class="menu-text"><i class="fa-solid fa-globe" aria-label="globe"></i></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default toc-left page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Incorporating Climate and Reproductive History Data</h1>
                  <div>
        <div class="description">
          <p>Understanding the challenges when using longitudinal data with DHS surveys</p>
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">Climate</div>
                <div class="quarto-category">Reproductive history</div>
                <div class="quarto-category">Longitudinal data</div>
                <div class="quarto-category">Time series</div>
                <div class="quarto-category">Methodology</div>
                <div class="quarto-category">Research concepts</div>
              </div>
                  </div>
  </div>
    
  <div class="quarto-title-meta-author">
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-heading">Affiliation</div>
    
      <div class="quarto-title-meta-contents">
      <p class="author">Sunnee Billingsley </p>
    </div>
    <div class="quarto-title-meta-contents">
          <p class="affiliation">
              Professor of Sociology, Stockholm University
            </p>
        </div>
    </div>

  <div class="quarto-title-meta">

        
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">June 11, 2024</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="1">
    <h2 id="toc-title">Contents</h2>
   
  <ul>
  <li><a href="#why-look-at-reproductive-histories-and-climate" id="toc-why-look-at-reproductive-histories-and-climate" class="nav-link active" data-scroll-target="#why-look-at-reproductive-histories-and-climate">Why look at reproductive histories and climate?</a></li>
  <li><a href="#what-we-need" id="toc-what-we-need" class="nav-link" data-scroll-target="#what-we-need">What we need</a></li>
  <li><a href="#what-is-available-in-dhs" id="toc-what-is-available-in-dhs" class="nav-link" data-scroll-target="#what-is-available-in-dhs">What is available in DHS</a></li>
  <li><a href="#making-it-work" id="toc-making-it-work" class="nav-link" data-scroll-target="#making-it-work">Making it work</a>
  <ul class="collapse">
  <li><a href="#defining-the-window-of-observation" id="toc-defining-the-window-of-observation" class="nav-link" data-scroll-target="#defining-the-window-of-observation">Defining the window of observation</a></li>
  <li><a href="#defining-the-timing-of-a-pregnancy" id="toc-defining-the-timing-of-a-pregnancy" class="nav-link" data-scroll-target="#defining-the-timing-of-a-pregnancy">Defining the timing of a pregnancy</a></li>
  <li><a href="#selecting-appropriate-covariates" id="toc-selecting-appropriate-covariates" class="nav-link" data-scroll-target="#selecting-appropriate-covariates">Selecting appropriate covariates</a></li>
  </ul></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">Conclusion</a>
  <ul class="collapse">
  
  </ul></li>
  </ul>
</nav>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
    </div>
<!-- main -->
<main class="content quarto-banner-title-block page-columns page-full" id="quarto-document-content">





<p>There have been heroic efforts to produce thorough, high-quality, publicly available climate data, which has provided new opportunities for researchers interested in climate demography. The wealth of climate resources we now have provide solid, well-organized, and fine-grained data on temperatures and rainfall and how these conditions vary over time. What is more challenging is getting the personal histories from surveys to line up with those data.</p>
<p>If researchers are interested in the relationship between climate and reproductive issues such as contraceptive use, sexual activity, and fertility preferences, data analysis can be relatively straightforward. Questions answered at the time of the survey give us this current information. We know where respondents live at the time of the survey and when the survey took place, so space and time are easily addressed.</p>
<p>If we want to unravel how climate might influence reproductive events, such as pregnancies, we need to look back across time at what happened, when, and where. This post addresses some common limitations and issues that can be tricky to work with when aligning climate and reproductive health data longitudinally.</p>
<p>Some of our focus below is on analyzing pregnancy history data collected prior to DHS Phase 8. For surveys from DHS Phase 8 forward (released after 2023), when pregnancy histories were routinely collected, analyzing reproductive events over time may be more straightforward. But any analysis of reproductive events using longitudinal data must grapple with issues related to migration, defining the period at risk of fetal loss, and making sound choices about covariates, all topics discussed in this post.</p>
<section id="why-look-at-reproductive-histories-and-climate" class="level1">
<h1>Why look at reproductive histories and climate?</h1>
<p>Research at the intersection of climate and reproductive health has already demonstrated important and concerning issues. In general, we know that rainfall and temperature conditions influence birth rates.<span class="citation" data-cites="bdg18 s17 sg19"><sup><a href="#ref-bdg18" role="doc-biblioref">1</a>–<a href="#ref-sg19" role="doc-biblioref">3</a></sup></span> Underlying this finding, however, are many distinct processes we are only beginning to understand. Weather can influence whether pregnancies are carried to term<span class="citation" data-cites="bs20"><sup><a href="#ref-bs20" role="doc-biblioref">4</a></sup></span> and increase the risk of miscarriage.<span class="citation" data-cites="ddg20 sackfl21"><sup><a href="#ref-ddg20" role="doc-biblioref">5</a>,<a href="#ref-sackfl21" role="doc-biblioref">6</a></sup></span> Weather may also affect whether pregnancies happen, as we know thermal stress from heat can reduce fecundity.<span class="citation" data-cites="bdg18 mfy17"><sup><a href="#ref-bdg18" role="doc-biblioref">1</a>,<a href="#ref-mfy17" role="doc-biblioref">7</a></sup></span></p>
<p>Beyond these direct, immediate effects, climate and weather events may have longer-term, indirect influences on reproductive health and outcomes. Food insecurity and infectious disease prevalence are both influenced by heat and rainfall and can impact women’s reproductive health.<span class="citation" data-cites="ddg20 d15 d19"><sup><a href="#ref-ddg20" role="doc-biblioref">5</a>,<a href="#ref-d15" role="doc-biblioref">8</a>,<a href="#ref-d19" role="doc-biblioref">9</a></sup></span> Birth spacing can shift depending on how breastfeeding is impacted by weather.<span class="citation" data-cites="rgb21"><sup><a href="#ref-rgb21" role="doc-biblioref">10</a></sup></span></p>
<p>If we consider individual agency, climate and weather may change childbearing preferences, including ideal family size.<span class="citation" data-cites="ets19"><sup><a href="#ref-ets19" role="doc-biblioref">11</a></sup></span> When agricultural production or labor needs shift in response to weather and climate, resources and income are affected, which can shape the demand for children.<span class="citation" data-cites="c06 mgbp00"><sup><a href="#ref-c06" role="doc-biblioref">12</a>,<a href="#ref-mgbp00" role="doc-biblioref">13</a></sup></span> Libido may decline in response to hotter temperatures.<span class="citation" data-cites="lm96 waj17"><sup><a href="#ref-lm96" role="doc-biblioref">14</a>,<a href="#ref-waj17" role="doc-biblioref">15</a></sup></span> Adaptation strategies to weather may also increase physical labor, which can reduce short-term fecundity.<span class="citation" data-cites="ecbbdhj21 ha97 p96 vshr94"><sup><a href="#ref-ecbbdhj21" role="doc-biblioref">16</a>–<a href="#ref-vshr94" role="doc-biblioref">19</a></sup></span></p>
<p>In sum, the pathways through which reproductive histories are affected by weather and climate are remarkably varied, and we have only begun to map these pathways.</p>
</section>
<section id="what-we-need" class="level1 page-columns page-full">
<h1>What we need</h1>
<p>When looking at factors that influence events over a reproductive life course, we can think in terms of time to an event, where we need to fill in the blanks before the event. The event of interest could be menarche, conception, a pregnancy outcome, or menopause. Along with having information about past pregnancies and births, for example, we need to know where women lived and, consequently, what they were exposed to, during the time preceding these events.</p>
<p>Getting the exposure correct is key to systematic and rigorous longitudinal analysis. We must ensure we are aligning individual and climate/weather data at the exact right moment in time and space. This alignment is generally facilitated through GPS location information provided at the level of the community at the time of the survey. But what happens if someone has not been living in that community long? Because we cannot correctly assign climate data before an individual moved to their location at the survey date, we must know something about the person’s residential history and adjust our sample accordingly.<span class="citation" data-cites="gb20"><sup><a href="#ref-gb20" role="doc-biblioref">20</a></sup></span></p>

<div class="no-row-height column-margin column-container"><div class="">
<p>Note that “exact” is relative. We do not need exact home addresses; rather, we need an idea of the environmental conditions around where people lived and worked. The spatial detail around this information varies according to the population-environment process we are investigating, just as the detail in the health survey data varies.</p>
</div></div><p>Besides having GPS location and knowing length of time at that location, we need full reproductive histories. Ideally, we want information about pregnancies as well as about the timing of live births. Knowing when a pregnancy began and ended (even if not in a live birth), as well as the nature of the ending, is essential for sorting out the different factors that link climate change and reproductive health.</p>
</section>
<section id="what-is-available-in-dhs" class="level1">
<h1>What is available in DHS</h1>
<p>The <a href="https://www.dhsprogram.com/data/">Demographic and Health Surveys</a> (DHS) remain the best source of individual- and household-level health data for poor and middle-income countries. The scope of the DHS program and the consistency of this survey enables standardization of results, which is key for comparing and generalizing findings.</p>
<p>In addition, The DHS Program has made some key decisions that increased the surveys’ usefulness to climate and health researchers. First, DHS began providing GPS coordinates that allow researchers to match climate measures to low-level locations (e.g., the approximate site of a village where the sample was drawn). Second, the survey began to collect information on how long individuals have resided at their current location. Many of us dream of full migration histories being collected by DHS, which would help us deal with bias caused by climate migration. At the moment, we have to assume that those who stayed were least affected by past weather events and climate shifts. Nevertheless, with information about the person’s length of time at their current residence, we can at least be sure we are correctly assigning the contextual measures to a location for the right amount of time.</p>
<p>These two pieces of information—GPS coordinates for the primary sampling unit and respondents’ length of time at their current residence—are not available in all DHS datasets. Although most recent data sets have this information, researchers must check whether older samples have variables such as <code>V104</code> (<code>RESIDEINTYR</code> in IPUMS DHS), which reports how many years a woman has lived in her place of residence.</p>
<p>The narrowest time intervals available in DHS data are generally months and years. For example, we have the month and year of birth for all women of childbearing age and for their offspring. We also have information on time of moving to the current location and on the date of the woman’s first cohabiting union. For data on reproductive events, DHS surveys conform to one of two types:</p>
<ol type="1">
<li><p><strong>Live birth histories:</strong> The year and month of each live birth to a woman is collected.</p>
<p>This information is recorded regardless of whether the child is still alive and whether the child lives with the mother. Although the birth history collection strategy misses pregnancies that do not lead to a live birth, it is superior to the common strategy in surveys and census sources of only documenting the ages of children in the household. Most DHS surveys from Phases 1 through 7 only collected birth histories from women of childbearing age.</p></li>
<li><p><strong>Pregnancy histories:</strong> The year and month of every pregnancy outcome is collected.</p>
<p>Pregnancy histories are more complete than live birth histories because they also capture any known conception that ends in a miscarriage, abortion, or stillbirth. Whether the specific outcomes of miscarriage, abortion or stillbirth are distinguished varies across these samples, with abortions and miscarriages commonly combined into one category.</p></li>
</ol>
<p>These two types of histories relate to the entire life of the woman. Until recently, fewer than 25 DHS surveys collected pregnancy histories. For DHS Phase 8 (with data distributed around 2023 or later), a pregnancy history rather than just a birth history was included the standard questionnaire that serves as the starting point for each country’s survey.</p>
<p>Besides the birth history or pregnancy history data, the DHS often collects monthly reproductive history data for women for the five years preceding a survey. The simplest 5-year reproductive calendars only report whether a woman experienced a birth, pregnancy, or pregnancy termination in each month. Most reproductive calendars also collect monthly information on family planning, including the type of contraception used and, often, the reason for its discontinuation. Combined with other information that situates the last five years in a woman’s reproductive history, the calendar data can be a rich resource. IPUMS DHS has made it easier to analyse calendar data, through providing integrated variables accessed by choosing “Woman month” as the unit of analysis.</p>
<p>But for maximum statistical power, which quickly becomes important when working with covariates and splitting the data into comparison groups, and to avoid left truncation of data (not knowing when contraceptive use or a pregnancy began), full birth or pregnancy histories are often preferable. The rest of this post focuses on strategies for working with full reproductive histories.</p>
</section>
<section id="making-it-work" class="level1 page-columns page-full">
<h1>Making it work</h1>
<section id="defining-the-window-of-observation" class="level2">
<h2 class="anchored" data-anchor-id="defining-the-window-of-observation">Defining the window of observation</h2>
<p>The first step is establishing the window of observation, that is, the time period when we know a woman is living at her current location. In the absence of detailed migration histories, we can begin this observation period with the exact month and year she moved to her current place of residence (when such detail is available). Alternatively, we can choose a standard reference period, such as the first January following the year she moved to her location. Since the most commonly available DHS migration variable covers “Years lived in place of residence” (<code>V104</code>/<code>RESIDEINTYR</code>), this last approach is often the most practical. Although we do not analyse births or pregnancies before that starting point, these unobserved events are used when creating information about the woman, such as parity or years since last birth/pregnancy outcome. For women who reported “always” living in their current location, the full reproductive history can be analyzed (i.e., events from age 15 until the time of interview).</p>
<p>Once the window of observation is constructed for each individual, and the sample selected to include only those observations, then climate data can be merged on to the unit of analysis (i.e., woman or woman month).</p>
</section>
<section id="defining-the-timing-of-a-pregnancy" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="defining-the-timing-of-a-pregnancy">Defining the timing of a pregnancy</h2>
<p>A particularly salient period during which climate and environment can affect reproduction is the time between conception and the end of a pregnancy. When working with live births, including data from the widely available DHS birth histories, the conception month is usually calculated by subtracting 9 months from the date of birth.</p>
<p>When working with pregnancy history data, the situation is sometimes more complicated. DHS samples with pregnancy histories always report the year and month a pregnancy ended. For this blog post, we focus on the 22 standard DHS surveys that collected pregnancy history data before (the current) Phase 8 survey. The Phase 8 approach is very different than the pre-Phase 8 approach and as a result data analysis approaches will need to be different. Strategies to use both the pre-phase 8 and the phase 8 data are useful to allow for longer-term investigations of climate impacts on pregnancy.</p>
<p>For the pre-Phase 8 data, the variable names relating to pregnancy history are sample-specific. In general, country- and year-specific variable names in DHS women’s surveys begin with the letter <code>s</code> followed by the number of the relevant question on the questionnaire. Thus, for example, on the women’s questionnaire for the 2012-2013 Pakistan sample, question number 226 records the month and year that each pregnancy ended. Accordingly, variables <code>s226m_XX</code> and <code>s226y_XX</code> respectively report “Month of pregnancy lost” and “Year of pregnancy lost,” with <code>XX</code> referencing the number of the pregnancy, from the most recent (<code>01</code>) to the twentieth most recent.</p>
<p>Figuring out the date of conception for pregnancies in pre-Phase 8 pregnancy histories can be difficult. Some of these surveys, such as the Pakistan 2012-13 sample, directly asked how long the pregnancy lasted. For many of the samples with early pregnancy histories, particularly from Eastern Europe and East Asia, this direct information about pregnancy duration (and thus conception date) is lacking.</p>
<p>In such cases, establishing the month of conception based on the month of miscarriage, abortion or stillbirth requires imputation. Knowing the month of conception is required for investigating climate impacts on pregnancy outcomes. One approach uses information derived from the five-year calendar data.<span class="citation" data-cites="bgb24"><sup><a href="#ref-bgb24" role="doc-biblioref">21</a></sup></span> In those data one can observe the month a woman said she was pregnant and the month when the pregnancy ended. By taking the difference, we can get an estimate of how long pregnancies lasted on average before the specific outcome in a specific culture. We can also calculate the mean and standard deviation for pregnancy outcomes for a given calendar sample and use those statistics as a structure for imputation. Note that reports from the calendar data may be sensitive to context—for example, the extent to which stillbirths are called miscarriages and vice versa. In addition, the length of gestation before abortion may vary by abortion legislation, which obviously varies across time and space. Thus, no clear rules of thumb, like “pregnancies ending in a live birth usually last 9 months,” can be stated for pregnancies ending in miscarriage, stillbirth, or abortion. Such estimates for terminated pregnancies should be context-specific (e.g., access to pregnancy tests) and empirically grounded.</p>
<p>Results from calendar-based imputed pregnancy duration data for one study are shown in Table 1, which details the pregnancy outcome timing from Armenian and Tajik DHS data.<span class="citation" data-cites="bgb24"><sup><a href="#ref-bgb24" role="doc-biblioref">21</a></sup></span> Only 65% of reported pregnancies ended in a live birth in Armenia during the five years preceding the survey (2015-16) and 84% in Tajikistan (2017). To impute the timing of conceptions ending in stillbirth, miscarriage, or abortion, the authors applied a normal (Gaussian) distribution using the mean and standard deviation observed in the five-year calendar data within the specific DHS data set.</p>
<table class="table-hover table-bordered column-body-outset caption-top table">
<caption>Table 1: Gestation by pregnancy outcome</caption>
<colgroup>
<col style="width: 34%">
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 18%">
<col style="width: 13%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th style="text-align: center;">Live Birth</th>
<th style="text-align: center;">Stillbirth</th>
<th style="text-align: center;">Miscarriage</th>
<th style="text-align: center;">Abortion</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Armenia, 2015-2016</strong></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
<tr class="even">
<td><em>Mean</em></td>
<td style="text-align: center;">8.56</td>
<td style="text-align: center;">6.77</td>
<td style="text-align: center;">2.57</td>
<td style="text-align: center;">2.24</td>
</tr>
<tr class="odd">
<td><em>Median</em></td>
<td style="text-align: center;">9</td>
<td style="text-align: center;">7</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">2</td>
</tr>
<tr class="even">
<td><em>SD</em></td>
<td style="text-align: center;">1.35</td>
<td style="text-align: center;">1.89</td>
<td style="text-align: center;">0.88</td>
<td style="text-align: center;">0.8</td>
</tr>
<tr class="odd">
<td><em>Min.</em></td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
</tr>
<tr class="even">
<td><em>Max.</em></td>
<td style="text-align: center;">10</td>
<td style="text-align: center;">9</td>
<td style="text-align: center;">7</td>
<td style="text-align: center;">9</td>
</tr>
<tr class="odd">
<td><em>Number of pregnancies</em></td>
<td style="text-align: center;">2,084</td>
<td style="text-align: center;">17</td>
<td style="text-align: center;">305</td>
<td style="text-align: center;">783</td>
</tr>
<tr class="even">
<td><strong>Tajikistan, 2017</strong></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
<tr class="odd">
<td><em>Mean</em></td>
<td style="text-align: center;">8.63</td>
<td style="text-align: center;">6.61</td>
<td style="text-align: center;">2.22</td>
<td style="text-align: center;">1.9</td>
</tr>
<tr class="even">
<td><em>Median</em></td>
<td style="text-align: center;">9</td>
<td style="text-align: center;">7</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">2</td>
</tr>
<tr class="odd">
<td><em>SD</em></td>
<td style="text-align: center;">1.28</td>
<td style="text-align: center;">1.93</td>
<td style="text-align: center;">1.18</td>
<td style="text-align: center;">1.02</td>
</tr>
<tr class="even">
<td><em>Min.</em></td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
</tr>
<tr class="odd">
<td><em>Max.</em></td>
<td style="text-align: center;">10</td>
<td style="text-align: center;">9</td>
<td style="text-align: center;">9</td>
<td style="text-align: center;">9</td>
</tr>
<tr class="even">
<td><em>Number of pregnancies</em></td>
<td style="text-align: center;">6,890</td>
<td style="text-align: center;">70</td>
<td style="text-align: center;">538</td>
<td style="text-align: center;">715</td>
</tr>
</tbody>
</table>
</section>
<section id="selecting-appropriate-covariates" class="level2">
<h2 class="anchored" data-anchor-id="selecting-appropriate-covariates">Selecting appropriate covariates</h2>
<p>A final consideration when working with retrospective longitudinal data is which variables can be used as covariates. Unless information comes in the form of histories, where we can track changes in a characteristic for an individual over time, we should only use information that does not change. Examples of non-changing variables are birth cohort and ethnicity/nationality.</p>
<p>The DHS provides a wealth of household and individual-level information that is unfortunately problematic when analyzing climate effects over time. This is generally unsatisfying, since we know socioeconomic factors play an important role in health outcomes. But ascribing back characteristics—such as household wealth quintile, woman’s employment status, her contraceptive knowledge, or her decision-making power at the time the survey—to the respondent earlier in time is risking a few problems. First, such ascription introduces error into the data, whereby a characteristic is assigned at a time for which it may not be true. Although it may seem relevant that the person eventually ended up with that characteristic, assigning the characteristic before it is true introduces estimation inconsistencies due to “anticipatory analyses”.<span class="citation" data-cites="hk06"><sup><a href="#ref-hk06" role="doc-biblioref">22</a></sup></span></p>
<p>While assuming that current characteristics held earlier is never completely reliable, error could be minimized by restricting analysis to recent pregnancies—for example, those occurring in the three years before the survey or focusing on only the most-recent and second-most-recent pregnancies (indexed <code>_01</code> and <code>_02</code>), if they occurred recently.</p>
<p>One option for gaining some measure of socioeconomic status that varies over time is to construct time-varying covariate variables. For example, from the variable that tells us the woman’s completed number of years of education (<code>V133</code>, or <code>EDYRTOTAL</code> in IPUMS DHS), we can produce a reasonable estimate of her last year in school. We can code the following years according to the highest level of education the respondent achieved. Similarly, we do not have partnership histories in DHS, but we do know the woman’s age at her first marriage or coresident union (<code>V511</code>, or <code>AGEFRSTMAR</code> in IPUMS DHS). From this information, we can construct a time-varying covariate for whether the woman had ever entered a co-resident union.</p>
</section>
</section>
<section id="conclusion" class="level1">
<h1>Conclusion</h1>
<p>Some of the pathways by which climate change affects health relate to reproductive events such as pregnancies and births. Analyzing such events over the life of a woman demands care on the part of researchers. One must, for example, “define the window of observation,” by excluding reproductive events that occurred before a woman migrated to her survey location. One must choose the type of longitudinal reproductive data: calendar data from the previous five years, birth history data, or pregnancy history data from across the woman’s life. Pregnancy history data in the IR (women’s) files from before and after DHS Phase 8 differ in variable naming conventions and scope. While dates for the end of pregnancies are consistently known, determining month of conception may need to rely on data imputation for some pre-Phase 8 samples. Covariates should reflect time-invariant characteristics, be restricted unless analyzing very recent pregnancies, or be constructed to reflect variation over time (e.g., in educational attainment).</p>
<p>Climate change and health research yields valid conclusions only when we avoid glaring errors—for example, assuming that environmental conditions were the same in a woman’s previous location as in her current residence, or that current characteristics (e.g., employment, household wealth) were static across time. We hope this post helps researchers avoid such errors and guides them in solving problems that arise with retrospective longitudinal reproductive histories.</p>

</section>

<div id="quarto-appendix" class="default"><section id="getting-help" class="level2 appendix"><h2 class="anchored quarto-appendix-heading">Getting Help</h2><div class="quarto-appendix-contents">

<p>Questions or comments? Check out the <a href="https://forum.ipums.org">IPUMS User Forum</a> or reach out to IPUMS User Support at ipums@umn.edu.</p>



</div></section><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" data-line-spacing="2" role="list">
<div id="ref-bdg18" class="csl-entry" role="listitem">
1. Barreca, A., Deschenes, O., &amp; Guldi, M. (2018). Maybe next month? Temperature shocks and dynamic adjustments in birth rates. <em>Demography</em>, <em>55</em>, 1269–1293.
</div>
<div id="ref-s17" class="csl-entry" role="listitem">
2. Simon, D. (2017). Exploring the influence of precipitation on fertility timing in rural <span>M</span>exico. <em>Population and Environment</em>, <em>38</em>, 407–423.
</div>
<div id="ref-sg19" class="csl-entry" role="listitem">
3. Sellers, S., &amp; Gray, C. (2019). Climate shocks constrain human fertility in <span>I</span>ndonesia. <em>World Development</em>, <em>117</em>, 357–369.
</div>
<div id="ref-bs20" class="csl-entry" role="listitem">
4. Barreca, A., &amp; Schaller, J. (2020). The impact of high ambient temperatures on delivery timing and gestational lengths. <em>Nature Climate Change</em>, <em>10</em>(1), 77. <a href="https://doi.org/10.1038/s41558-019-0632-4">https://doi.org/10.1038/s41558-019-0632-4</a>
</div>
<div id="ref-ddg20" class="csl-entry" role="listitem">
5. Davenport, F., Dorélien, A., &amp; Grace, K. (2020). Investigating the linkages between pregnancy outcomes and climate in sub-<span>S</span>aharan <span>A</span>frica. <em>Population and Environment</em>, <em>41</em>, 397–421.
</div>
<div id="ref-sackfl21" class="csl-entry" role="listitem">
6. Sexton, J., Andrews, C., Carruthers, S., Kumar, S., Flenady, V., &amp; Lieske, S. (2021). Systematic review of ambient temperature exposure during pregnancy and stillbirth: Methods and evidence. <em>Environmental Research</em>, <em>197</em>. <a href="https://doi.org/10.1016/j.envres.2021.111037">https://doi.org/10.1016/j.envres.2021.111037</a>
</div>
<div id="ref-mfy17" class="csl-entry" role="listitem">
7. Mao, H., Feng, L., &amp; Yang, W. X. (2017). Environmental factors contributed to circannual rhythm of semen quality. <em>Chronobiology International</em>, <em>34</em>, 411–425.
</div>
<div id="ref-d15" class="csl-entry" role="listitem">
8. Dorélien, A. M. (2015). Effects of birth month on child health and survival in sub-<span>S</span>aharan <span>A</span>frica. <em>Biodemography and Social Biology</em>, <em>61</em>, 209–230.
</div>
<div id="ref-d19" class="csl-entry" role="listitem">
9. Dorélien, A. (2019). The effects of in utero exposure to influenza on birth and infant outcomes in the US. <em>Population and Development Review</em>, <em>45</em>, 489–523.
</div>
<div id="ref-rgb21" class="csl-entry" role="listitem">
10. Randell, H., Grace, K., &amp; Bakhtsiyarava, M. (2021). Climatic conditions and infant care: Implications for child nutrition in rural <span>E</span>thiopia. <em>Population and Environment</em>, <em>42</em>, 524–552.
</div>
<div id="ref-ets19" class="csl-entry" role="listitem">
11. Eissler, S., Thiede, B. C., &amp; Strube, J. (2019). Climatic variability and changing reproductive goals in sub-<span>S</span>aharan <span>A</span>frica. <em>Global Environmental Change</em>, <em>57</em>. <a href="https://doi.org/10.1016/j.gloenvcha.2019.03.011">https://doi.org/10.1016/j.gloenvcha.2019.03.011</a>
</div>
<div id="ref-c06" class="csl-entry" role="listitem">
12. Caldwell, J. C. (2006). On net intergenerational wealth flows: An update. In <em>Demographic transition theory</em>. Springer Science &amp; Business Media.
</div>
<div id="ref-mgbp00" class="csl-entry" role="listitem">
13. Montgomery, M. R., Gragnolati, M., Burke, K. A., &amp; Paredes, E. (2000). Measuring living standards with proxy variables. <em>Demography</em>, <em>37</em>, 155–174.
</div>
<div id="ref-lm96" class="csl-entry" role="listitem">
14. Lam, D. A., &amp; Miron, J. A. (1996). The effects of temperature on human fertility. <em>Demography</em>, <em>33</em>, 291–305.
</div>
<div id="ref-waj17" class="csl-entry" role="listitem">
15. Wilde, J., Apouey, B. H., &amp; Jung, T. (2017). The effect of ambient temperature shocks during conception and early pregnancy on later life outcomes. <em>European Economic Review</em>, <em>97</em>, 87–107.
</div>
<div id="ref-ecbbdhj21" class="csl-entry" role="listitem">
16. Ebi, K. L., Capon, A., Berry, P., Broderick, C., Dear, R. de, Havenith, G., others, &amp; Jay, O. (2021). Hot weather and heat extremes: Health risks. <em>Lancet</em>, <em>398</em>, 698.
</div>
<div id="ref-ha97" class="csl-entry" role="listitem">
17. Higgins, P. A., &amp; Alderman, H. (1997). Labor and women’s nutrition: The impact of work effort and fertility on nutritional status in <span>G</span>hana. <em>Journal of Human Resources</em>, 577–595.
</div>
<div id="ref-p96" class="csl-entry" role="listitem">
18. Panter-Brick, C. (1996). Proximate determinants of birth seasonality and conception failure in <span>N</span>epal. <em>Population Studies</em>, <em>50</em>, 203–220.
</div>
<div id="ref-vshr94" class="csl-entry" role="listitem">
19. Vartiainen, H., Suonio, S., Halonen, P., &amp; Rimón, R. (1994). Psychosocial factors, female fertility and pregnancy: A prospective study—part II: pregnancy. <em>Journal of Psychosomatic Obstetrics &amp; Gynecology</em>, <em>15</em>(2), 77–84.
</div>
<div id="ref-gb20" class="csl-entry" role="listitem">
20. Grace, K., Billingsley, S., &amp; Van Riper, D. (2020). Building an interdisciplinary framework to advance conceptual and technical aspects of population-environment research focused on women’s and children’s health. <em>Social Science &amp; Medicine</em>, <em>250</em>.
</div>
<div id="ref-bgb24" class="csl-entry" role="listitem">
21. Billingsley, S., Grace, K., &amp; Bakhtsiyarava, M. (2024). Climate change and getting pregnant: Weather exposure and a full accounting of conceptions in <span>A</span>rmenia and <span>T</span>ajikistan. <em>Stockholm Research Reports in Demography</em>, <em>2024</em>(06).
</div>
<div id="ref-hk06" class="csl-entry" role="listitem">
22. Hoem, J., &amp; Kreyenfeld, M. (2006). Anticipatory analysis and its alternatives in life-course research: Part 1: Education and first childbearing. <em>Demographic Research</em>, <em>15</em>, 461–484.
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/ipums\.github\.io\/dhs-research-hub");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
<p>Developed by <a href="https://www.ipums.org">IPUMS</a> at the University of Minnesota<br>Licensed under the <a href="https://www.mozilla.org/en-US/MPL/2.0/">Mozilla Public License Version 2.0</a></p>
</div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>